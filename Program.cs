using Microsoft.Extensions.Configuration;

namespace HttpSnorlax;

public class Program
{
    private static IConfiguration _configuration;
    private static readonly HttpClient Client = new();

    static async Task Main(string[] args)
    {
        var builder = new ConfigurationBuilder()
            .SetBasePath(Directory.GetCurrentDirectory())
            .AddJsonFile("appsettings.json")
            .AddJsonFile("appsettings.Development.json");

        _configuration = builder.Build();
        
        await Process();
    }

    private static async Task Process()
    {
        var url = _configuration["Url"];
        
        // Set up SO dataset
        var serviceOrderIds = new List<string>
        {
            "2751536"//,"2751528","2751509","2717651","2717611","2717601","2717579","2717550","2717516","2717477","2717439","2717425","2717402","2624348","2624313","2624274","2624228","2585985","2585708","2530908","2530897","2530885","2530841","2530834","2530790","2409473","2409366","2409359","2409341","2409333","2409303","2406354","2406309","2405947","2405905","2405860","2332938","2332916","2332911","2332896","2286596","2286582","2286548","2286543","2286521","2286514","2286491","2286482","2286434","2146508","2146503","2146460","2146452","2146431","2099814","2099790","2099787","2099745","2099274","2099273","2099240","1971386","1971362","1971344","1920130","1920118","1920113","1920110","1920095","1920057","1920053","1898216","1898200","1898193","1898171","1898143","1898115","1791876","1791862","1791854","1791847","1791843","1791818","1724098","1724082","1723982","1723658","1693166","1693136","1693120","1693071","1693066","1605978","1605967","1605961","1605930","1605922","1605911","1605904","1545135","1545101","1545077","1545068","1488833","1488816","1488802","1488780","1488758","1458100","1458095","1458084","1458077","1458065","1458061","1342547","1342505","1342495","1342471","1297729","1297721","1297717","1297666","1297660","1297635","1297626","1297619","1262790","1262772","1262770","1262763","1262761","1262750","1228626","1228615","1228591","1228571","1228545","1228521","1156660","1156653","1156631","1156626","1156597","1156587","1156563","1156538","1156527","1156503","1008433","1008418","1008406","1008390","941356","941349","941348","904650","904648","900232","900215","876450","876435","876434","876421","876420","876402","876401","876389","821146","808434","803901","803723","785137"
        };

        foreach (var id in serviceOrderIds)
        {
            Console.WriteLine("Sending sync request for SO {0} at {1}...", id, DateTime.Now);
            
            var soUrl = url.Replace("{id}", id);
            
            var result = await Client.PostAsync(soUrl, null);
            if (result.IsSuccessStatusCode)
            {
                Console.WriteLine("Request successful!");
            }
            else
            {
                Console.WriteLine("Request failed! HTTP {0}", result.StatusCode);
            }
            
            await Task.Delay(1000);
        }

        Console.WriteLine("Exiting...");
    }
}
